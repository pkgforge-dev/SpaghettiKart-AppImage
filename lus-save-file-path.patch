From 8ddd3650bb174ac6d3ec1eff8a79594ab1d1f308 Mon Sep 17 00:00:00 2001
From: AltoXorg <56553686+Alto1772@users.noreply.github.com>
Date: Fri, 25 Jul 2025 22:30:08 +0800
Subject: [PATCH] obey app directory for default.sav

---
 src/public/libultra/os_eeprom.cpp | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/src/public/libultra/os_eeprom.cpp b/src/public/libultra/os_eeprom.cpp
index 3ba36bb06..14541a624 100644
--- a/src/public/libultra/os_eeprom.cpp
+++ b/src/public/libultra/os_eeprom.cpp
@@ -10,7 +10,8 @@ int32_t osEepromLongRead(OSMesgQueue* mq, uint8_t address, uint8_t* buffer, int3
     u8 content[512];
     s32 ret = -1;
 
-    FILE* fp = fopen("default.sav", "rb");
+    const std::string save_file = Ship::Context::GetPathRelativeToAppDirectory("default.sav");
+    FILE* fp = fopen(save_file.c_str(), "rb");
     if (fp == NULL) {
         return -1;
     }
@@ -34,7 +35,8 @@ int32_t osEepromLongWrite(OSMesgQueue* mq, uint8_t address, uint8_t* buffer, int
     }
     memcpy(content + address * 8, buffer, length);
 
-    FILE* fp = fopen("default.sav", "wb");
+    const std::string save_file = Ship::Context::GetPathRelativeToAppDirectory("default.sav");
+    FILE* fp = fopen(save_file.c_str(), "wb");
     if (fp == NULL) {
         return -1;
     }
@@ -46,4 +48,4 @@ int32_t osEepromLongWrite(OSMesgQueue* mq, uint8_t address, uint8_t* buffer, int
 int32_t osEepromWrite(OSMesgQueue* mq, uint8_t address, uint8_t* buffer) {
     return osEepromLongWrite(mq, address, buffer, 8);
 }
-}
\ No newline at end of file
+}
